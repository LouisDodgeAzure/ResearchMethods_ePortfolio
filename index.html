<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>E‑Portfolio – Module Unit Summaries</title>
  <meta name="description" content="Single‑page e‑portfolio template that supports local development and GitHub Pages via a simple mode flag, auto‑discovering per‑unit JSON files." />
  <style>
    :root { --bg:#f8fafc; --surface:#ffffff; --text:#0f172a; --muted:#475569; --border:#e2e8f0; --accent:#2563eb; --chip:#eaf2ff; --focus:#94a3b8; --radius-xl:16px; --shadow-sm:0 2px 8px rgba(2,6,23,.05); --shadow-md:0 8px 24px rgba(2,6,23,.08); --maxw:1200px; }
    @media (prefers-color-scheme: dark){ :root{ --bg:#0b1220; --surface:#0f172a; --text:#e6edf7; --muted:#94a3b8; --border:#1f2a44; --accent:#60a5fa; --chip:#0b234a; --focus:#334155; --shadow-sm:0 2px 8px rgba(0,0,0,.3); --shadow-md:0 12px 28px rgba(0,0,0,.35);} }
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica Neue,Arial;color:var(--text);background:radial-gradient(1200px 400px at 50% -10%, rgba(37,99,235,.08), transparent 60%),var(--bg);line-height:1.6;scroll-behavior:smooth}
    a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
    .wrapper{max-width:var(--maxw);margin:0 auto;padding:24px clamp(16px,3vw,32px);display:grid;grid-template-columns:300px 1fr;gap:28px}
    header.site{position:sticky;top:0;z-index:10;backdrop-filter:saturate(140%) blur(6px);background:color-mix(in hsl, var(--bg), transparent 25%);border-bottom:1px solid var(--border)}
    .site-inner{max-width:var(--maxw);margin:0 auto;padding:14px clamp(16px,3vw,32px);display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:grid;gap:2px} .brand b{font-size:1.05rem;letter-spacing:.2px} .brand small{color:var(--muted)}
    .actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn{appearance:none;border:1px solid var(--border);background:var(--surface);color:var(--text);padding:8px 12px;border-radius:999px;font-weight:600;font-size:.9rem;box-shadow:var(--shadow-sm);cursor:pointer}
    .btn:hover{border-color:color-mix(in hsl, var(--accent), var(--border) 60%)}
    nav#toc{position:sticky;top:68px;align-self:start;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);box-shadow:var(--shadow-sm);padding:14px}
    #toc h2{font-size:.95rem;margin:6px 8px 12px;color:var(--muted)}
    .toc-list{list-style:none;margin:0;padding:0;display:grid;gap:6px}
    .toc-list a{display:grid;grid-template-columns:28px 1fr;align-items:center;gap:8px;padding:8px 10px;border-radius:10px;border:1px solid transparent}
    .toc-list a:hover{background:var(--chip);border-color:color-mix(in hsl, var(--accent), transparent 70%);text-decoration:none}
    .toc-unit{display:inline-grid;place-content:center;width:24px;height:24px;background:var(--accent);color:white;border-radius:6px;font:600 12px/1 ui-sans-serif,system-ui}
    main{display:grid;gap:16px}
    .intro{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);box-shadow:var(--shadow-md);padding:clamp(16px,2.5vw,28px)}
    .meta{display:flex;flex-wrap:wrap;gap:12px;color:var(--muted);font-size:.95rem}
    .chip{background:var(--chip);padding:4px 10px;border-radius:999px;border:1px solid color-mix(in hsl, var(--accent), transparent 70%)}
    .units{display:grid;gap:18px}
    section.unit{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);box-shadow:var(--shadow-sm);padding:clamp(16px,2.5vw,28px);position:relative}
    .unit header{display:grid;gap:8px;margin-bottom:8px}
    .unit h2{margin:0;font-size:clamp(1.1rem,1.2rem + .4vw,1.6rem);line-height:1.25;letter-spacing:.2px}
    .unit h2 .hash{opacity:0;transition:opacity .2s ease;margin-left:8px;font-weight:700;color:var(--accent)}
    .unit:hover h2 .hash{opacity:1}

    /* CONSISTENT SUMMARY LAYOUT */
    .unit .summary{display:grid;row-gap:10px;border-left:3px solid color-mix(in hsl, var(--accent), transparent 70%);padding-left:12px}
    .unit .summary p{margin:0;display:grid;grid-template-columns:12ch 1fr;column-gap:12px;align-items:start}
    .unit .summary p .label{color:var(--muted);font-weight:600}

    .docs{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;margin-top:12px}
    .doc{display:grid;gap:4px;padding:10px 12px;border:1px dashed color-mix(in hsl, var(--accent), var(--border) 75%);border-radius:12px}
    .doc a{font-weight:600} .doc small{color:var(--muted)}
    .refs{margin-top:8px;font-size:.95rem;color:var(--muted)} .refs li{margin-bottom:4px}
    .sr-only{position:absolute !important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    @media (max-width:960px){.wrapper{grid-template-columns:1fr} nav#toc{position:relative;top:0}}
    @media print{header.site,nav#toc{display:none !important} body{background:#fff} a{color:#000;text-decoration:none} a[href^="#"]::after{content:""} section.unit{box-shadow:none;break-inside:avoid;page-break-inside:avoid}}
  </style>
</head>
<body id="top">
  <a class="sr-only" href="#content">Skip to content</a>

  <header class="site" role="banner">
    <div class="site-inner">
      <div class="brand">
        <b>E‑Portfolio · Unit Summaries</b>
        <small><span aria-hidden>👤</span> <span id="brandMeta">Louis Dodge · Module: <em>Methods and Professional Practice July 2025 B.</em> · Academic Year: 2025</span></small>
      </div>
      <div class="actions">
        <a class="btn" href="#toc">Jump to Units</a>
        <a class="btn" href="#top" title="Back to top">Top</a>
      </div>
    </div>
  </header>

  <div class="wrapper">
    <nav id="toc" aria-label="Units navigation">
      <h2>Units</h2>
      <ol class="toc-list" id="tocList"></ol>
    </nav>

    <main id="content" role="main">
      <section class="intro" aria-labelledby="intro-title">
        <h1 id="intro-title" style="margin-top:0">About this e‑portfolio</h1>
        <p>This page supports <strong>both local and GitHub</strong> data sources via a simple flag:</p>
        <ul>
          <li><b>local</b>: loads <code>units/*.json</code> from the same folder as this page (optionally via a <code>units/index.json</code> manifest).</li>
          <li><b>github</b>: auto‑discovers <code>units/*.json</code> via the GitHub API from your public repo.</li>
          <li><b>auto</b>: uses <b>local</b> on <code>localhost</code>/<code>127.0.0.1</code>/<code>file:</code>, otherwise <b>github</b>.</li>
        </ul>
        <div class="meta">
          <span class="chip">Local dev mode</span>
          <span class="chip">GitHub Pages ready</span>
          <span class="chip">Per‑unit documents</span>
          <span class="chip">Anchor links</span>
        </div>
      </section>

      <div class="units" id="units"></div>
    </main>
  </div>

  <script>
    // ---------------- CONFIG ----------------
    const CONFIG = {
      mode: 'auto', // 'local' | 'github' | 'auto'
      student: 'Louis Dodge',
      module: 'Methods and Professional Practice July 2025 B.',
      academicYear: '2025',
      github: {
        user: 'your-github-username',
        repo: 'your-repo',
        branch: 'main',      // or 'gh-pages'
        unitsDir: 'units'    // e.g. /units/unit-1.json
      },
      local: {
        unitsDir: 'units',               // where unit JSONs live locally
        useManifest: true,               // set true to use units/index.json
        manifest: 'units/index.json',    // a JSON array of filenames
        probePattern: 'unit-${n}.json',  // fallback if no manifest
        startAt: 1,
        maxUnits: 30
      }
    };

    // --------------- Helpers ---------------
    function resolveHref(href){ try{ return new URL(href, window.location.origin + window.location.pathname).href; }catch{ return href; } }
    function fileIcon(t){ const type=(t||'').toLowerCase(); if(type.includes('pdf'))return'📄'; if(type.includes('slide')||type.includes('ppt'))return'📽️'; if(type.includes('doc'))return'📝'; if(type.includes('sheet')||type.includes('xls'))return'📊'; if(type.includes('code'))return'🧩'; if(type.includes('page')||type.includes('html'))return'🔗'; return'🔗'; }
    function computeWordCount(str){ if(!str) return 0; return (str.trim().match(/\b\w+\b/g)||[]).length; }

    const elUnits = document.getElementById('units');
    const elToc = document.getElementById('tocList');
    const brandMeta = document.getElementById('brandMeta');

    // ------------- Data loaders -------------
    async function fetchGithubUnits(cfg){
      const base = `https://api.github.com/repos/${cfg.user}/${cfg.repo}/contents/${cfg.unitsDir}?ref=${cfg.branch}`;
      const listResp = await fetch(base);
      if(!listResp.ok) throw new Error('Failed to list units directory: ' + listResp.status);
      const list = await listResp.json();
      const jsonFiles = list.filter(item => item.type === 'file' && /\.json$/i.test(item.name));
      const units = [];
      for(const f of jsonFiles){
        const rawUrl = `https://raw.githubusercontent.com/${cfg.user}/${cfg.repo}/${cfg.branch}/${cfg.unitsDir}/${encodeURIComponent(f.name)}`;
        const r = await fetch(rawUrl);
        if(!r.ok){ console.warn('Failed to fetch', f.name); continue; }
        units.push(await r.json());
      }
      return units;
    }

    async function fetchLocalUnits(cfg){
      const units = [];
      if(cfg.useManifest){
        try{
          const m = await fetch(cfg.manifest, { cache: 'no-store' });
          if(m.ok){
            const list = await m.json();
            const files = Array.isArray(list) ? list : (Array.isArray(list.files) ? list.files : []);
            for(const name of files){
              const r = await fetch(`${cfg.unitsDir}/${name}`, { cache: 'no-store' });
              if(r.ok) units.push(await r.json());
            }
            return units;
          } else {
            console.warn('Manifest not found, falling back to probe.');
          }
        }catch(err){ console.warn('Manifest load error, falling back to probe.', err); }
      }
      const { startAt=1, maxUnits=24, probePattern='unit-${n}.json' } = cfg;
      for(let n=startAt; n<=maxUnits; n++){
        const filename = probePattern.replace('${n}', n);
        const url = `${cfg.unitsDir}/${filename}`;
        try{
          const r = await fetch(url, { cache: 'no-store' });
          if(r.ok){ units.push(await r.json()); }
        }catch{ /* ignore */ }
      }
      return units;
    }

    // --------------- Renderer ---------------
    function render(units){
      brandMeta.innerHTML = `${CONFIG.student} · Module: <em>${CONFIG.module}</em> · Academic Year: ${CONFIG.academicYear}`;
      const sorted = (units||[]).slice().sort((a,b)=> (a.number||0)-(b.number||0) || String(a.id).localeCompare(String(b.id)));

      // TOC
      elToc.innerHTML = '';
      sorted.filter(u=>u && u.title).forEach(u=>{
        const li = document.createElement('li');
        li.innerHTML = `<a href="#${u.id}"><span class="toc-unit">${u.number ?? ''}</span><span>${u.title}</span></a>`;
        elToc.appendChild(li);
      });

      // Units
      elUnits.innerHTML = '';
      sorted.forEach(u=>{
        if(!u || !u.id) return;
        const docs = Array.isArray(u.documents)?u.documents:[];
        const section = document.createElement('section');
        section.className = 'unit';
        section.id = u.id;
        section.setAttribute('aria-labelledby', `${u.id}-title`);
        section.innerHTML = `
          <header>
            <h2 id="${u.id}-title">Unit ${u.number ?? ''}: ${u.title}<a class="hash" href="#${u.id}" aria-label="Anchor to ${u.title}">#</a></h2>
            <div class="summary">
              ${u.activities?`<p><span class="label">Activities:</span><span>${u.activities}</span></p>`:''}
              ${u.skills?`<p><span class="label">Skills:</span><span>${u.skills}</span></p>`:''}
              ${u.impact?`<p><span class="label">Integration & Impact:</span><span>${u.impact}</span></p>`:''}
            </div>
            ${docs.length?`<div class="docs">${docs.map(d=>`
              <div class="doc">
                <a href="${resolveHref(d.href)}" target="_blank" rel="noopener">${fileIcon(d.type)} ${d.title||d.href}</a>
                ${d.desc?`<small>${d.desc}</small>`:''}
              </div>`).join('')}</div>`:''}
            ${Array.isArray(u.references)&&u.references.length?`<ol class="refs">${u.references.map(r=>`<li>${r}</li>`).join('')}</ol>`:''}
          </header>`;
        elUnits.appendChild(section);
      });
    }

    // ----------------- Boot -----------------
    (async function boot(){
      let units = [];
      const isLocalHost = ['localhost','127.0.0.1','::1'].includes(location.hostname) || location.protocol === 'file:';
      const mode = CONFIG.mode === 'auto' ? (isLocalHost ? 'local' : 'github') : CONFIG.mode;
      try{
        units = (mode === 'local') ? await fetchLocalUnits(CONFIG.local) : await fetchGithubUnits(CONFIG.github);
      }catch(e){
        console.error(e);
        const err = document.createElement('p');
        err.textContent = `Failed to load units in ${mode} mode. Check CONFIG and file paths.`;
        document.getElementById('content').appendChild(err);
      }
      render(units);
    })();
  </script>
</body>
</html>
